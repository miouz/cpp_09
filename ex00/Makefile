NAME := span

# ============================================================================ #
#                               COMPILOR & FLAGS                                  #
# ============================================================================ #

MAKE_CMD ?= $(MAKE)
CXX := c++
CXXFLAGS := -Wall -Wextra -Werror -g
CXXFLAGS += -std=c++98

# ============================================================================ #
#                                DIRECTORIES                                   #
# ============================================================================ #

SRC_DIR := .
OBJ_DIR := objs

# ============================================================================ #
#                                  SOURCES                                     #
# ============================================================================ #

#Main
# MAIN_SRC := $(SRC_DIR)/main.c

# Get all .c files recursively
SRCS := $(shell find $(SRC_DIR) -name '*.cpp')

#Convert source files to object files
OBJS := $(SRCS:$(SRC_DIR)/%.cpp=$(OBJ_DIR)/%.o)

TEST_SCRIPT = test.sh

# ============================================================================ #
#                                   COLORS                                     #
# ============================================================================ #

#color variables
RED := \033[0;31m
GREEN := \033[0;32m
YELLOW := \033[0;33m
BLUE := \033[0;34m
MAGENTA := \033[0;35m
CYAN := \033[0;36m
WHITE := \033[0;37m
RESET := \033[0m
BOLD := \033[1m

# ============================================================================ #
#                                  ðŸ«¡RULES                                      #
# ============================================================================ #


#Default target
all: $(NAME)
	@printf "$(GREEN)$(BOLD)âœ“ Build complete!\n$(RESET)"

#Link the final executable
$(NAME): $(OBJS)
	@printf "$(CYAN)Linking $(NAME)...\n$(RESET)"
	@$(CXX) $(CXXFLAGS) $(OBJS) -o $(NAME)
	@printf "$(GREEN)$(BOLD)âœ“ $(NAME) created successfully!ðŸ¥³ðŸ¥³ðŸ¥³\n$(RESET)"

#Compile source files to object files
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp
	@mkdir -p $(dir $@)
	@printf "$(YELLOW)Woah Compiling $<... (ï¾‰â—•ãƒ®â—•)ï¾‰\n$(RESET)"
	@$(CXX) $(CXXFLAGS) -c $< -o $@

#Test suit
test: $(NAME)
	@if [ ! -f $(TEST_SCRIPT) ]; then \
		printf "$(RED)$(TEST_SCRIPT) not Found\n"; \
		exit 1; \
	fi
	@chmod +x $(TEST_SCRIPT)
	@printf "$(BLUE)Running Tests Files\n$(RESET)"
	@./$(TEST_SCRIPT)

# ============================================================================ #
#                                 ðŸ»CLEANNING                                    #
# ============================================================================ #

clean:
	@rm -rf $(OBJ_DIR)
	@printf 'ðŸ§¹$(GREEN)Cleaning .o files... m(ï½¡â‰§ï½´â‰¦ï½¡)m$(RESET)ðŸ§¹ðŸ§¹\n'

fclean: clean
	@rm -f $(NAME)
	# rm -f $(NAME_BONUS)
	@printf 'ðŸ§¹ðŸ§¹$(GREEN)Nothing left...áƒš(â—‰â—žà±ªâ—Ÿâ—‰ )áƒš$(RESET)ðŸ§¹ðŸ§¹\n'

re: fclean $(NAME)

# ============================================================================ #
#                              MAKEFILE SETTING                                #
# ============================================================================ #

#not print command
.SILENT:

#Delete target files if command fails
.DELETE_ON_ERROR:

.PHONY: all clean fclean re bonus
